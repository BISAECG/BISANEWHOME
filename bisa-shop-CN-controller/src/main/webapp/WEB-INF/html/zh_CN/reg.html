<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>注册</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link href="../resources/ctrl/bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../resources/css/comm/base.css" rel="stylesheet">
    <link href="../resources/css/index/comm.css" rel="stylesheet">
    <link href="../resources/ctrl/font-awesome-4.7.0/css/font-awesome.css" rel="stylesheet">
    <link href="../resources/css/index/HK_Reg.css" rel="stylesheet">
    <link href="../resources/css/static/reg.css" rel="stylesheet">
    <script src="../resources/js/comm/jquery.min.js"></script>
    <script src="../resources/ctrl/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
</head>

<body>
    <div id="header"></div>
    <script>
        $("#header").load("head.html");
    </script>
    <div class="container">
        <div class="main">
            <div class="pos-r clear min-h-560  bg-white  z-9   pt-40 pb-20">
                <div class="register-title">
                    <div class="col-xs-12 text-center ">
                        <span class="title-selected" >手机号注册</span>
                    </div>
                </div>
                <div class="clear pl-41 msg-wrap mt-40">
                    <div class="msg-error ">
                        <b></b><span></span>
                    </div>
                </div>
                <div class="clear register-tabcontentv1">
                    <form class="register-main-formphone form-horizontal" action="../web/call/reg" method="post">
                        <div class="clear  form-group  mt-10 phonecode-box pos-r" style="margin-left: 0px;margin-right: 0px;">
                            <div class="clear input-group col-xs-12 ">
                                <div  class="clear text-center   input-group-addon bg-white bor bor-c">
                                    <select
                                        class="form-control bor-col-white boxsha-none focu-bor-66afe9 pr-12i radius-3i sel-telphone" id="selectpicker" name="selectpicker ">
                                    </select>
                                </div>
                                <div class="clear  text-center mr-0 ml-0 radius-0 ">
                                    <input
                                        class="form-control pt-7 pb-7 pl-5 pr-5 full-wh radius-tf-0i bor-l-none  userphoneinput"
                                        type="text" name="phone" maxlength="15" placeholder="请输入正确的手机号码">
                                    <!-- 请输入正确的手机号码！ -->
                                    <span class="userphonemsg  clear dis-b text-left pull-left"></span>
                                </div>
                
                            </div>
                        </div>
                        <div class="clear form-group  mt-30 " style="margin-left: 0px;margin-right: 0px;">
                            <div class="clear input-group col-xs-12">
                                <div class="clear  text-center   mr-0 ml-0 radius-0 pos-r ">
                                    <input class="form-control  full-wh radius-tf-0i "
                                        id="varify_code" type="text" name="icode" maxlength="4"
                                        placeholder="请输入动态密码" >
                                    <!-- 请输入您接收的动态密码. -->
                                    <span class="usercodemsg  clear dis-b text-left"></span>
                                    <button type="button" 
                                    class="pos-a   z-99  btn  text-center sendMessagebtn">
                                    获取动态密码
                                </button>
                                </div>
                            </div>
                        </div>
                        <div class="clear h-50 form-group  mt-30" style="margin-left: 0px;margin-right: 0px;">
                            <div class="clear input-group col-xs-12">
                                <div class="clear h-50 line-h-50 text-center  radius-0  ">
                                    <input class="form-control pt-7 pb-7 pl-5 pr-5 full-wh radius-tf-0i "
                                        type="password" name="password" maxlength="16" placeholder="请设置您的密码">
                                    <!-- 请设置您的密码. -->
                                    <span class="user-pwd-msg  clear dis-b text-left"></span>
                                </div>
                            </div>
                        </div>
                        <div class="clear h-50 form-group mt-30" style="margin-left: 0px;margin-right: 0px;">
                            <div class="clear input-group col-xs-12">
                          
                                <div class="clear h-50 line-h-50 text-center  radius-0  ">
                                    <input class="form-control pt-7 pb-7 pl-5 pr-5 full-wh radius-tf-0i "
                                        type="password" name="setpassword" maxlength="16" placeholder="请确认您的密码">
                                    <!-- 请确认您的密码. -->
                                    <span class="user-setpwd-msg  clear dis-b text-left"></span>
                                </div>
                            </div>
                        </div>
                        <div class="clear mt-30">
                            <button type="submit" class="btn full-w text-center register-submit" >
                                <a href="successReg.html">注册</a>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="clear h-20 line-h-20 f-20 col-666  text-right mt-20 mb-5 login">
                    <span>已有账号</span>
                    <a  href="login.html">
                        立即登录
                    </a>
                </div>
            </div>
        </div>
    </div>




    <script src="../resources/ctrl/bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>
    <script src="../resources/js/comm/bootstrapValidator.min.js"></script>
    <script src="../resources/ctrl/layer/layer.js"></script>
    <script src="../resources/js/reg/arealist.js"></script>
    <script>
        $(document).ready(function () {

            loadAreaList(); //加载地区、区号相关数据，function位于areaList.js

            //弹出提示信息
            show_msg();

            function show_msg() {
                var msg = message;
                if (msg != null && msg != '' && msg != 'null' && msg != 'unfine' && msg != '') {
                    msg = getMessage(msg);
                    showMessage(msg);
                }
            }

            /*注册部分的js*/
            /*手机注册校验*/
            $(".register-main-formphone").bootstrapValidator({
                fields: {
                    phone: {
                        container: '.userphonemsg',
                        validators: {
                            notEmpty: {
                                message: '手机号码不能为空值.' //'手机号码不能为空值.'
                            },
                            stringLength: {
                                min: 6,
                                max: 15,
                                message: '手机号码不能小于6或者大于15.' //'手机号码不能小于6或者大于15.'
                            },
                            regexp: {
                                regexp: /^[0-9-]+$/,
                                message: '手机号码只能包含数字和连接符.' //'手机号码只能包含数字和连接符.'
                            },
                        }
                    },
                    icode: {
                        container: '.usercodemsg',
                        validators: {
                            notEmpty: {
                                message: '动态密码不能为空值.' //'动态密码不能为空值.'
                            },
                            digits: {
                                message: '只能是数字！' //'只能是数字！'
                            },
                            stringLength: {
                                min: 4,
                                max: 4,
                                message: '必须是4位数字!' //'必须是4位数字!'
                            }
                        }
                    },
                    password: {
                        container: '.user-pwd-msg',
                        validators: {
                            notEmpty: {
                                message: '密码不能为空值.' //'密码不能为空值.'
                            },
                            different: {
                                field: 'userphone',
                                message: '密码和手机号不能一样' //'密码和手机号不能一样'
                            },
                            regexp: {
                                regexp: /^[a-zA-Z0-9_]+$/,
                                message: '密码只能包含大写、小写、数字或下划线.' //'密码只能包含大写、小写、数字或下划线.'
                            },
                            stringLength: {
                                min: 8,
                                max: 16,
                                message: '密码长度不能小于8位,不能大于16位.' //'密码长度不能小于8位,不能大于16位.'
                            },
                        }
                    },
                    setpassword: {
                        container: '.user-setpwd-msg',
                        validators: {
                            notEmpty: {
                                message: '密码不能为空值.' //'密码不能为空值.'
                            },
                            different: {
                                field: 'userphone',
                                message: '密码和手机号不能一样.' //'密码和手机号不能一样.'
                            },
                            identical: {
                                field: 'password',
                                message: '两次密码不一致.' //'两次密码不一致.'
                            },
                        }
                    },
                }
            });
            /*发送短信验证码*/
            $(".sendMessagebtn").click(function () { //点击微信登录
                sendMessage()
            });

            function sendMessage() {
                var InterValObj; //timer变量，控制时间
                var count = 90; //间隔函数，1秒执行
                var curCount; //当前剩余秒数
                var code = ""; //验证码
                var codeLength = 4; //验证码长度
                var curCount = count;
                var phoneNumber = $(".userphoneinput").val(); //拿到当前输入的手机号码
                var passverify = $(".phonecode-box").hasClass("has-success");
                var select = $("#selectpicker").val();
                console.log(select);
                if (passverify) { //验证手机号
                    //产生验证码 ,向用户手机发送验证码由后台实现,前台实现了倒计时
                    //向后台发送处理数据
                    $.ajax({ //当点击发送验证码时,可能向后台执行的ajax事件
                        type: "GET", //用POST方式传输
                        dataType: "text", //数据格式:json
                        contentType: "application/x-www-form-urlencoded;charset=utf-8",
                        url: http_request + "/web/call/phoneRegisterCode?phone=" + phoneNumber +
                            "&selectpicker=" + select,
                        success: function (msg) {
                            if (msg == "200") {
                                //设置button效果，开始计时
                                $(".sendMessagebtn").attr("disabled", "true"); //禁用重新发送按钮
                                $(".sendMessagebtn").css("color", "#666"); //修改按钮值颜色
                                $(".sendMessagebtn").text(curCount + "s" +
                                    '重新发送'); //按钮值修改为 '倒计时' + '重新发送'
                                InterValObj = window.setInterval(SetRemainTime,
                                    1000); //启动计时器，1秒执行一次
                            } else {
                                msg = getMessage(msg);
                                showMessage(msg);
                            }
                        }
                    });
                } else {
                    $(".userphonemsg").find("small:visible").text('请输入正确的手机号码'); //请输入正确的手机号码！
                    $(".userphoneinput").focus(); //获取手机号输入框input焦点
                    return false;
                }

                //timer处理函数
                function SetRemainTime() {
                    if (curCount == 0) { //当倒计时等于0时
                        window.clearInterval(InterValObj); //停止计时器
                        $(".sendMessagebtn").removeAttr("disabled"); //启用重新发送按钮
                        $(".sendMessagebtn").css("background-color", "#D7DCDE");
                        $(".sendMessagebtn").css("border-color", "#D7DCDE");
                        $(".sendMessagebtn").css("color", "#868b8a"); //修改按钮值颜色
                        $(".sendMessagebtn").text("按钮值修改为重新发送"); //按钮值修改为重新发送
                        code = ""; //清除验证码。如果不清除，过时间后，输入收到的验证码依然有效
                    } else {
                        curCount--; //当倒计时不等于0时
                        $(".sendMessagebtn").text(curCount + "s" + '重新发送'); //倒计时执行计数
                    }
                };
            };
        });

        /*微信登录 鼠标悬浮事件*/
        $(".register-tabcontrolv3").mouseenter(function () {
            $(this).find("img").attr("src", http_request + "/../resources/img/reg/tabcontrolv3h.png");
            $(this).find("span").css("color", "black");
        });
        $(".register-tabcontrolv3").mouseleave(function () {
            $(this).find("img").attr("src", http_request + "/../resources/img/reg/tabcontrolv3.png");
            $(this).find("span").css("color", "#999");
        });

        /*异常信息*/
        function showMessage(msg) {
            msg = "<b></b><span>" + msg + "</span>";
            $(".msg-error").html(msg);
            $(".msg-error").css("display", "block");
        }

        /*根据消息代码显示异常信息*/
        function getMessage(msg) {
            if (msg == "1001") {
                return "手机号不能为空！";
            } //"手机号不能为空！"
            if (msg == "200" || msg == "1003") {
                return "账号已注册，请登录！";
            } //"账号已注册，请登录！"
            if (msg == "1004") {
                return "操作失败！";
            } //"操作失败！"
            if (msg == "1005") {
                return '验证码错误！';
            } //验证码错误！
            if (msg == "1007") {
                return '地区有误';
            } //地区有误！
        }
    </script>
</body>
</html>